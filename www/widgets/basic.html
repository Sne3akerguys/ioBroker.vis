<script type="text/javascript">
    "use strict";

    if (vis.editMode) {
        // Add words for basic widgets
        $.extend(true, systemDictionary, {
            // Bars
            "src":             {"en": "Source",               "de": "Quelle",              "ru": "Адрес"},
            "refreshInterval": {"en": "Refresh interval(ms)", "de": "Updatezeit(ms)",      "ru": "Интервал обновления(ms)"},
            "is_comma":        {"en": "Divider comma",        "de": "Komme als Trennung",  "ru": "Запятая-разделитель"},
            "digits":          {"en": "Digits after comma",   "de": "Zeichen nach Komma",  "ru": "Знаков после запятой"},
            "oid":             {"en": "Object ID",            "de": "Object ID",           "ru": "ID Объекта"},
            "html_prepend":    {"en": "Prepend value",        "de": "Voranstellen HTML",   "ru": "Префикс значения"},
            "html_append":     {"en": "Append to value",      "de": "HTML anhängen",       "ru": "Суффикс значения"},
            "html_append_singular": {
                "en" : "Append to value (Singular)",
                "de": "HTML anhängen (Singulär)",
                "ru": "Суффикс значения(един.ч.)"
            },
            "html_append_plural": {
                "en" : "Append to value (Plural)",
                "de": "HTML anhängen(Plüral)",
                "ru": "Суффикс значения(множ.ч.)"
            },
            "html_prepend_tooltip":    {
                "en": "Write HTML code here that will be placed before,\x0Ae.g. <b> ",
                "de": "HTML Kod, der wird vom dem Wert platziert,\x0Az.B. <b>",
                "ru": "HTML код будет помещён перед значением,\x0Aнапример <b>"
            },
            "html_append_tooltip":     {
                "en": "Write HTML code here that will be placed before,\x0Ae.g. </b>",
                "de": "HTML Kod, der wird vom dem Wert platziert,\x0Az.B. </b>",
                "ru": "HTML код будет помещён после значения,\x0Aнапример </b>"
            },
            "stretch":         {"en": "Stretch",               "de": "Streken",            "ru": "Растянуть"},
            "factor":          {"en": "Multiplex factor",      "de": "Multiplikation",     "ru": "Множитеть"},
            "class_true":      {"en": "Class if quality 'true'", "de": "Kalsse bei Qualität 'true'", "ru": "Класс, если качество 'true'"},
            "class_false":     {"en": "Class if quality 'false'", "de": "Kalsse bei Qualität 'false'", "ru": "Класс, если качество 'false'"},
            "test_html":       {"en": "Text for test",         "de": "Testtext",           "ru": "Тестовый текст"},
            "test_html_tooltip": {
                "en": "You can specify the test text if value is now empty to visualise settings.\x0AIt is valid only during edit.",
                "de": "Man kann noch Testtext setzen um die Einstellungen visuell zu sehen.\x0ADas ist nur während Edit gültig.",
                "ru": "Можно задать тестовый текст, что бы видеть настройки визуально.\x0AОн действителен только во время редактирования."
            },
            "html":            {"en": "HTML",                  "de": "HTML",               "ru": "HTML"},
            "oid-quality":     {"en": "Quality ID",            "de": "Qualität ID",        "ru": "ID-Качество"},
            "oid-quality_tooltip":     {
                "en": "You can set additionally Quality ID to indicate if the value valid or not.",
                "de": "Man kann noch zusätzlich Qualität ID setzetn um zu zeigen ob das Wert aktuell ist.",
                "ru": "Можно дополнительно установить ID-Качества, что бы показать актуальное значение или нет."},
            "title":           {"en": "Title",                 "de": "Titel",              "ru": "Заголовок"},
            "title_font":      {"en": "Title font name",       "de": "Titelschriftname",   "ru": "Шрифт заголовка"},
            "title_color":     {"en": "Title color",           "de": "Titelfarbe",         "ru": "Цвет заголовка"},
            "title_back":      {"en": "Title backg. color",    "de": "Titelhintergrund",   "ru": "Цвет фона текста"},
            "title_top":       {"en": "Title top padding",     "de": "Titel-Oben-Abstand", "ru": "Отступ заголовка сверху"},
            "title_left":      {"en": "Title left padding",    "de": "Titel-Links-Abstand", "ru": "Отступ заголовка слева"},
            "header_height":   {"en": "Header height",         "de": "Kopfhöhe",           "ru": "Высота заголовока"},
            "header_color":    {"en": "Header color",          "de": "Kopffarbe",          "ru": "Цвет фона заголовка"},
            "refreshOnWakeUp": {"en": "Refresh on wake up",    "de": "Update bei Aufwachen", "ru": "Обновлять при выходе из сна"},
            "refreshOnViewChange": {"en": "Refresh on view change", "de": "Update bei Viewwechsel", "ru": "Обновлять при смене страницы"},
            "src_":            {"en": "URL, by value=",        "de": "URL falls Wert=",     "ru": "Адрес при значении "},
            "nav_view":        {"en": "View to navigate",      "de": "View zum Navigieren", "ru": "Перейти на страницу"},
            "group_effects":   {"en": "Show/Hide Effects",     "de": "Anzeige Effekte",     "ru": "Эффекты появления/исчезновения"},
            "group_extended":  {"en": "Extended settings",     "de": "Erweiterte Eistellungen", "ru": "Расширенные настройки"},
            "body-background": {"en": "Background color by changing", "de": "Hintegrund by Wechsel", "ru": "Фон при смене страниц"},
            "sync":            {"en": "Hide and show together:", "de": "Anzeigen und verbergen gleichzeitig", "ru": "Появления и исчезновение вместе"},
            // Effects
            "show":            {"en": "show", "de": "show", "ru": "show"},
            "blind":           {"en": "blind", "de": "blind", "ru": "blind"},
            "bounce":          {"en": "bounce", "de": "bounce", "ru": "bounce"},
            "clip":            {"en": "clip", "de": "clip", "ru": "clip"},
            "drop":            {"en": "drop", "de": "drop", "ru": "drop"},
            "explode":         {"en": "explode", "de": "explode", "ru": "explode"},
            "fade":            {"en": "fade", "de": "fade", "ru": "fade"},
            "fold":            {"en": "fold", "de": "fold", "ru": "fold"},
            "highlight":       {"en": "highlight", "de": "highlight", "ru": "highlight"},
            "puff":            {"en": "puff", "de": "puff", "ru": "puff"},
            "pulsate":         {"en": "pulsate", "de": "pulsate", "ru": "pulsate"},
            "scale":           {"en": "scale", "de": "scale", "ru": "scale"},
            "shake":           {"en": "shake", "de": "shake", "ru": "shake"},
            "size":            {"en": "size", "de": "size", "ru": "size"},
            "slide":           {"en": "slide", "de": "slide", "ru": "slide"},
            "is_milliseconds": {"en": "Milliseconds", "de": "Millisekunden", "ru": "Миллисекунды"},
            "is_milliseconds_tooltip": {
                "en": "Is object is milliseconds from 1970.01.01 00:00:00. Normally no.",
                "de": "Ob das Wert die Milleskunden seit 1970.01.01 00:00:00 ist. Normalerweise nicht.",
                "ru": "Является ли значение объекта миллисекундами с 1970.01.01 00:00:00. Обычно нет."
            },
            "format_date":     {"en": "Dateformat", "de": "Datumformat", "ru": "Формат даты"},
            "format_date_tooltip": {
                "en": "Dateformat",
                "de": "Datumformat",
                "ru": "Формат даты"
            },

            "hide_effect":     {"en": "Hide effect",           "de": "Verbergeneffekt",    "ru": "Эффект скрытия"},
            "hide_duration":   {"en": "Hide duration(ms)",     "de": "Verbergendauer",     "ru": "Длительность скрытия(мс)"},
            "hide_options":    {"en": "Hide options",          "de": "Verbergenoptionen",  "ru": "Опции скрытия"},
            "show_effect":     {"en": "Show effect",           "de": "Anzeigeeffekt",      "ru": "Эффект появления"},
            "show_duration":   {"en": "Show duration(ms)",     "de": "Anzeigedauer",       "ru": "Длительность появления(мс)"},
            "show_options":    {"en": "Show options",          "de": "Anzeigeoptionen",    "ru": "Опции появления"},
            "left":            {"en": "left",                  "de": "links",              "ru": "лево"},
            "right":           {"en": "right",                 "de": "rechts",             "ru": "право"},
            "top":             {"en": "top",                   "de": "oben",               "ru": "верх"},
            "bottom":          {"en": "bottom",                "de": "unten",              "ru": "низ"},

            "contains_view":   {"en": "Contains view",         "de": "Viewname",           "ru": "Имя страницы"},
            "persistent":      {"en": "Persistent",            "de": "Bleibend",           "ru": "Постоянно"},
            "persistent_tooltip": {
                "en": "If persistent the view will not be destroyed when inactive, just hide.\nElsewise the view will be destroyed, if inactive.",
                "de": "Falls 'Bleibend', dann wird die View nicht zerstört, sondern nur versteckt wenn inaktive. Sonst wird die View immer wieder kreiert und zerstört.",
                "ru": "Если выбранно 'Постоянно', то страница не будет уничтожаться, если она не активна. В противном случае страница будет создаваться и разрушаться."},
            "valuelist":       {"en": "Values list",           "de": "Wertenliste",        "ru": "Список значений"},
            "valuelist_tooltip": {
                "en": "Divide values with semicolon, like 'ok;warning;alram'. Every text accordingly for value 0,1,2 and so on",
                "de": "Die Werte mit Semikolon trennen, wie 'ok;Warnung;Alarm'. Jeder Text ist entsprechend für das Wert 0,1,2 usw.",
                "ru": "Разделять значения точкой запятой, например 'ok;Внимание;Тревога'. Каждый текст соответственно для значения 0,1,2 итд."},
            "html_false":      {"en": "HTML by 'false'",       "de": "HTML bei 'false'",   "ru": "HTML если 0"},
            "html_true":       {"en": "HTML by 'true'",        "de": "HTML bei 'true'",    "ru": "HTML если 1"},
            "text_false":      {"en": "Text by 'false'",       "de": "Text bei 'false'",   "ru": "Текст если 0"},
            "text_true":       {"en": "Text by 'true'",        "de": "Text bei 'true'",    "ru": "Текст если 1"},
            "svg_false":       {"en": "SVG by 'true'",         "de": "SVG bei 'true'",     "ru": "SVG если 0"},
            "svg_true":        {"en": "SVG by 'true'",         "de": "SVG bei 'true'",     "ru": "SVG если 1"},
            "opacity":         {"en": "Opacity",               "de": "Durchsichtigkeit",   "ru": "Текст если 1"},
            "html_closed":     {"en": "HTML by 'closed'",      "de": "HTML bei 'zu'",      "ru": "HTML если закрыто"},
            "html_open":       {"en": "HTML by 'open'",        "de": "HTML bei 'auf'",     "ru": "HTML если открыто"},
            "html_tilt":       {"en": "HTML by 'tilted'",      "de": "HTML bei 'gekippt'", "ru": "HTML если наклоненно"},
            "html_tilt_tooltip": {
                "en": "0 - Closed, 1 - tilt, 2 - open",
                "de": "0- Zu, 1 - gekippt, 2 - auf",
                "ru": "0 - закрыто, 1 - откинуто, 2 - открыто"
            },
            "color":           {"en": "Color",                 "de": "Farbe",              "ru": "Цвет"},
            "shadow":          {"en": "Opacity",               "de": "Durchsichtigkeit",   "ru": "Тень"},
            "shadow_tooltip":  {
                "en": "CSS Shadow, like '10px 10px 5px #888888'",
                "de": "CSS Shatten, wie '10px 10px 5px #888888'",
                "ru": "CSS Тень, как '10px 10px 5px #888888'"
            },
            "reverse":         {"en": "Revers value",          "de": "Wert umkehren",      "ru": "Перевернуть значение"},
            "border":          {"en": "Border",                "de": "Rand",               "ru": "Окантовка"},
            "border_tooltip":  {
                "en": "CSS border, like 'green 5px solid'",
                "de": "CSS Rand, wie 'green 5px solid'",
                "ru": "CSS бордюр, как 'green 5px solid'"
            },
            "test_text":       {"en": "Test text",             "de": "Testtext",           "ru": "Тестовый текст"},
            "max_width":       {"en": "Max. width",            "de": "Maximale Breite",    "ru": "Максимальная ширина"},
            "style":           {"en": "Style for ",            "de": "Stil für ",          "ru": "Стиль для "},
            "style_tooltip":   {
                "en": "Write here css style, like: 'color:red;background:white'",
                "de": "Hier muss CSS Stil stehen, wie 'color:red;background:white'",
                "ru": "CSS Стиль, например: 'color:red;background:white'"},
            "count":           {"en": "Values number to",      "de": "Wertsanzahl bis",        "ru": "Количество значений до"}
        });
    }

    $.extend(true, systemDictionary, {
        "Edit note": {"en": "Edit note", "de": "Meldung eingeben", "ru": "Сообщение"},
        "Clear": {"en": "Clear", "de": "Löschen", "ru": "Очистить"},
        "Ok": {"en": "Ok", "de": "Ok", "ru": "Ok"},
        "Cancel": {"en": "Cancel", "de": "Abbrechen", "ru": "Отмена"}
    });

    vis.binds.stateful = {
        view: function (el, viewArr, persistent) {
            var $this = $(el);
            var oid   = $this.attr('data-oid');

            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                var view = viewArr[newVal];
                if (!persistent) {
                    $this.parent().find('div.vis-view').remove();
                } else {
                    $this.parent().find('div.vis-view').hide().appendTo($('#vis_container'));
                }
                if (vis.views[view]) {
                    vis.renderView(view);
                    $('#visview_' + view).appendTo($this).show();
                }
            });
        },
        iframe: function (el, srcArr, refreshInterval) {
            var $this = $(el).parent().find('iframe');
            var oid   = $this.attr('data-oid');

            vis.states.bind(oid + ".val", function (e, newVal, oldVal) {
                $this.attr('src', srcArr[newVal]);
            });

            if (vis.states[oid + '.val'] !== undefined) {
                $this.attr('src', srcArr[vis.states[oid + '.val']]);
            }

            if (refreshInterval > 0) {
                setInterval(function () {
                    var val = vis.states[oid + '.val'] || 0;
                    var src = srcArr[val];
                    $this.attr("src", src + (src.match(/\?/) ? '&' : '?') + '_vis_refts=' + ((new Date()).getTime()));
                }, refreshInterval);
            }
        },
        image: function (el, srcArr, refreshInterval) {
            var $this = $(el).parent().find("img");
            var oid = $this.attr('data-oid');

            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                $this.attr('src', srcArr[newVal]);
            });

            if (vis.states[oid + '.val'] !== undefined) {
                $this.attr('src', srcArr[vis.states[oid + '.val']]);
            }

            if (refreshInterval > 0) {
                setInterval(function () {
                    var val = vis.states[oid + '.val'] || 0;
                    var src = srcArr[val];
                    if (src) $this.attr('src', src + ((src.indexOf('?') != -1) ? '&' : '?') + '_vis_refts=' + ((new Date()).getTime()));
                }, refreshInterval);
            }
        },
        value: function (values, oid) {
            if (oid != 'nothing_selected' && vis.states.attr(oid + '.val') !== undefined) {
                return values[vis.states.attr(oid + '.val')];
            } else {
                return values[0];
            }
        }
    };
    vis.binds.container = function (el, view) {
        var $this = $(el);
        if (vis.views[view]) {
            vis.renderView(view);
            $('#visview_' + view).appendTo($this).show();
        }
    };
    vis.binds.basic = {
        filterDropdown: function (el, filters, hideEffect, hideDuration, showEffect, showDuration) {
            var $this = $(el);
            if (filters) {
                filters = filters.split(';');
                for (var i = 0; i < filters.length; i++) {
                    $this.find('select').append('<option value="' + filters[i] + '">' + filters[i] + '</option>');
                }
            }

            if (vis.viewsActiveFilter[vis.activeView]) {
                $this.find('select option[value="' + vis.viewsActiveFilter[vis.activeView] + '"]').attr('selected', true);
            }

            $this.find('select').change(function () {
                vis.changeFilter($this.find('select option:selected').val(), hideEffect, hideDuration, showEffect, showDuration);
            });

        },
        state: function (el, oid) {
            var $this = $(el);
            var oid = (oid ? oid : $this.attr('data-oid'));
            var val = $this.attr('data-val');

            if (oid) $this.attr('data-oid', oid);

            if (val === 'true')  val = true;
            if (val === 'false') val = false;

            if (!vis.editMode) {
                $this.on('click', function (e) {
                    vis.setValue($(this).attr('data-oid'), $(this).attr('data-val'));
                });
                // @geolin - auch das musste ich wieder entfernen weil es zu doppelter Ausführung geführt hat.
                /*
                 $this.on('touchend',function (e) {
                    $(this).trigger('click');
                 });
                */
            }
        },
        pressed: null,
        pressedNext: null,
        increment: function (el, minmax, delay, interval) {

            function fInterval($that) {
                vis.binds.basic.pressedNext = true;
                var oid = $that.attr('data-oid');
                if (!vis.editMode) {
                    var step = parseFloat($that.attr('data-vis-step'));
                    var tmp  = parseFloat(vis.states[oid + '.val']) + step;
                    if (step < 0) {
                        if (tmp >= minmax) {
                            vis.setValue($that.attr('data-oid'), tmp);
                            vis.binds.basic.pressed = _setTimeout(fInterval, interval, $that);
                        }
                    } else {
                        if (tmp <= minmax) {
                            vis.setValue($that.attr('data-oid'), tmp);
                            vis.binds.basic.pressed = _setTimeout(fInterval, interval, $that);
                        }
                    }
                }
            }

            function intervalStart(e) {
                vis.binds.basic.pressedNext = false;
                var $this = $(this);
                var oid = $this.attr('data-oid');
                vis.binds.basic.pressed = setTimeout(fInterval, delay, $this);
            }

            if (!vis.editMode) {
                $(el).click(function (e) {
                    clearTimeout(vis.binds.basic.pressed);
                    if (vis.binds.basic.pressedNext) {
                        vis.binds.basic.pressedNext = false;
                        return;
                    }
                    var $this = $(this);
                    var oid = $this.attr('data-oid');
                    var step = parseFloat($this.attr('data-vis-step'));
                    var tmp  = parseFloat(vis.states[oid + '.val']) + step;
                    if (step < 0) {
                        if (tmp >= minmax) {
                            vis.setValue($this.attr('data-oid'), tmp);
                        }
                    } else {
                        if (tmp <= minmax) {
                            vis.setValue($this.attr('data-oid'), tmp);
                        }
                    }
                });
            }

            if (interval) {
                $(el).on('mousedown', intervalStart)
                    .on('touchstart', intervalStart)
                    .on('touchend', function () {
                        clearTimeout(vis.binds.basic.pressed);
                    })
                    .on('mouseup', function () {
                        clearTimeout(vis.binds.basic.pressed);
                    });
            }
        },
        navigation: function (el, options) {
            var $this = $(el);
            $this.click(function (e) {
                if (!vis.editMode) {
                    if (options.background) {
                        $('body').css({background: options.background});
                    }
                    vis.changeView(options.nav_view, options.hideOptions, options.showOptions, options.sync);
                    //e.preventDefault();
                    //return false;
                }

            });
        },
        hideOnFalse: function (el) {
            var $this = $(el);
            var oid = $this.attr('data-oid');
            vis.states.bind(oid + ".val", function (e, newVal, oldVal) {
                if (newVal === null || newVal === false || newVal === 0 || newVal === "false" || parseInt(newVal,10) == 0) {
                    if (!vis.editMode) {
                        $this.hide();
                    }
                } else {
                    $this.show();
                }
            });
            if (!vis.editMode) {
                var newVal = vis.states.attr(oid + ".val");
                if (newVal === null || newVal === false || newVal === 0 || newVal === "false" || parseInt(newVal,10) == 0) {
                    $this.hide();
                }
            }
        },
        hideOnTrue: function (el) {
            var $this = $(el);
            var oid = $this.attr('data-oid');
            vis.states.bind(oid + ".val", function (e, newVal, oldVal) {
                if (newVal === true || parseFloat(newVal) > 0) {
                    if (!vis.editMode) {
                        $this.hide();
                    }
                } else {
                    $this.show();
                }
            });
            if (!vis.editMode) {
                if (parseFloat(vis.states.attr(oid + ".val")) != 0 && vis.states.attr(oid + ".val") !== false) {
                    $this.hide();
                }
            }
        },
        showOnValue: function (el, val) {
            var $this = $(el);
            var oid = $this.attr('data-oid');
            vis.states.bind(oid + ".val", function (e, newVal, oldVal) {
                if (newVal != val) {
                    if (!vis.editMode) {
                        $this.hide();
                    }
                } else {
                    $this.show();
                }
            });
            if (!vis.editMode) {
                if (vis.states.attr(oid + ".val") != val) {
                    $this.hide();
                }
            }
        },
        _onChange: function (el, oid, wid) {
            var $this = $(el);
            // If still working
            //console.log(oid + ' ' + vis.states.attr(oid + '.val') + ' (' + vis.states.attr(oid + '.ack') + ') - ' + wid + ' ' + vis.states.attr(wid + '.val') + ' (' + vis.states.attr(wid + '.ack') + ')');

            if (wid && (vis.states.attr(wid + '.val') === true)) return;

            var val = vis.states.attr(oid + '.val');

            if (val === 'false') {
                val = false;
            } else if (val === 'true') {
                val = true;
            } else if (typeof val == 'string') {
                var f = parseFloat(val);
                if (f == val) {
                    val = f;
                } else if (val !== '') {
                    val = true;
                } else {
                    val = false;
                }
            }

            if ($this.data('data-numeric')) {
                $this.prop('checked', (val > (($this.data('data-max') - $this.data('data-min')) / 2)));
            } else {
                $this.prop('checked', val);
            }

        },
        checkbox: function (el, numeric, min, max) {
            var $this = $(el);
            var oid   = $this.attr('data-oid'); // Object ID
            var wid   = $this.attr('data-oid-working'); // Work ID

            if (oid) {
                vis.states.bind(oid + '.val', function (e, val, oldVal) {
                    vis.binds.basic._onChange(el, oid, wid);
                });
                if (wid) {
                    vis.states.bind(wid + '.val', function (e, val, oldVal) {
                        vis.binds.basic._onChange(el, oid, wid);
                    });
                }
            }

            if (numeric) {
                if (min !== undefined && min !== null && min !== '') {
                    min = parseFloat(min);
                } else {
                    min = 0;
                }

                if (max !== undefined && max !== null && max !== '') {
                    max = parseFloat(max);
                } else {
                    max = 1;
                }
            } else {
                min = false;
                max = true;
            }

            $this.data('data-min',     min);
            $this.data('data-max',     max);
            $this.data('data-numeric', numeric);

            vis.binds.basic._onChange(el, oid, wid);

            if (!vis.editMode) {
                $this.change(function () {
                    var $this_ = $(this);
                    if ($this_.prop('checked')) {
                        vis.setValue($this_.attr('data-oid'), $this_.data('data-max'));
                    } else {
                        vis.setValue($this_.attr('data-oid'), $this_.data('data-min'));
                    }
                });
            }
        },
        select: function (el, invert) {
            var $this = $(el).prev();
            var oid   = $this.attr('data-oid');
            var val   = vis.states[oid + '.val'];

            if (val === 'false') {
                val = false;
            } else if (val === 'true') {
                val = true;
            } else if (typeof val == 'string') {
                var f = parseFloat(val);
                if (f == val) {
                    val = f;
                } else if (val !== '') {
                    val = true;
                } else {
                    val = false;
                }
            }

            if (invert) val = !val;

            $this.val(val ? 1 : 0);
            if (!vis.editMode) {
                if (oid != 'nothing_selected') {
                    $this.change(function () {
                        var val = $this.find('option:selected').val();
                        if (invert) val = !val;
                        vis.setValue(oid, val);
                    });
                }
            }
            if (oid != 'nothing_selected') {

            }
            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                if (newVal === 'false') {
                    newVal = false;
                } else if (newVal === 'true') {
                    newVal = true;
                } else if (typeof newVal == 'string') {
                    var f = parseFloat(newVal);
                    if (f == newVal) {
                        newVal = f;
                    } else if (newVal !== '') {
                        newVal = true;
                    } else {
                        newVal = false;
                    }
                }
                if (oldVal === 'false') {
                    oldVal = false;
                } else if (oldVal === 'true') {
                    oldVal = true;
                } else if (typeof oldVal == 'string') {
                    var f = parseFloat(oldVal);
                    if (f == oldVal) {
                        oldVal = f;
                    } else if (oldVal !== '') {
                        oldVal = true;
                    } else {
                        oldVal = false;
                    }
                }

                if (newVal == oldVal) return;

                if (newVal === 'false' || newVal === false || parseFloat(newVal) == 0) {
                    if ($this.find('option[value="1"]').prop('selected')) {
                        $this.find('option[value="1"]').prop('selected', false);
                        $this.find('option[value="0"]').prop('selected', true);
                        $this.trigger('change');
                    }
                } else {
                    if ($this.find('option[value="0"]').prop('selected')) {
                        $this.find('option[value="0"]').prop('selected', false);
                        $this.find('option[value="1"]').prop('selected', true);
                        $this.trigger('change');
                    }
                }
            });
        },
        toggle: function (el, oid) {
            var $this = $(el);
            var oid = oid || $this.attr('data-oid');

            if (oid && !vis.editMode) {
                // @geolin - musste das wieder entfernen - das führt zu doppelter Ausführung (Gerät geht kurz an und sofort wieder aus bzw umgekehrt)
                //$this.on('touchend', function () { $(this).trigger('click'); });

                $this.on('click', function () {
                    var _oid = $(this).attr('data-oid');
                    var val = vis.states[oid + '.val'];
                    if (val === null || val === '' || val === undefined || val === false || val === 'false') {
                        vis.setValue(oid, true);
                    } else if (val === true || val === 'true') {
                        vis.setValue(oid, false);
                    } else {
                        val = parseFloat(val);
                        if (val >= 0.5) {
                            val = 1;
                        } else {
                            val = 0;
                        }
                        vis.setValue(oid, 1 - val);
                    }
                });
            }
        },
        iframeRefresh: function (el, src, refreshInterval) {
            refreshInterval = parseInt(refreshInterval, 10);
            if (src && !vis.editMode && refreshInterval > 0) {
                var $this = $(el).parent().find('iframe');
                refreshInterval = parseInt(refreshInterval, 10);
                setInterval(function () {
                    if ($this.is(':visible') && $this.parents(':hidden').length == 0) {
                        $this.attr('src', src + ((src.indexOf('?') != -1) ? '&' : '?') + '_vis_refts=' + ((new Date()).getTime()));
                    }
                }, refreshInterval);
            }
        },
        htmlRefresh: function (el, html, refreshInterval) {
            refreshInterval = parseInt(refreshInterval, 10);
            if (html && !vis.editMode && refreshInterval > 0) {
                var $this = $(el);
                refreshInterval = parseInt(refreshInterval, 10);
                setInterval(function () {
                    if ($this.is(':visible') && $this.parents(':hidden').length == 0) {
                        $this.html(html);
                    }
                }, refreshInterval);
            }
        },
        imgRefresh: function (el, src, refreshInterval, refreshOnWakeUp, refreshOnViewChange) {
            var $this = $(el).parent().find('img');

            if (!vis.editMode && src) {
                refreshInterval = parseInt(refreshInterval, 10);

                if (refreshOnViewChange) {
                    var widgetView = vis.activeView;
                    vis.navChangeCallbacks.push(function (view) {
                        if (view == widgetView) {
                            $this.attr('src', src + ((src.indexOf('?') != -1) ? '&' : '?') + '_vis_refts=' + ((new Date()).getTime()));
                        }
                    });
                }
                if (refreshInterval > 0) {
                    setInterval(function () {
                        if ($this.is(':visible') && $this.parents(':hidden').length == 0) {
                            $this.attr('src', src + ((src.indexOf('?') != -1) ? '&' : '?') + '_vis_refts=' + ((new Date()).getTime()));
                        }
                    }, refreshInterval);
                }
                if (refreshOnWakeUp) {
                    //console.log("refreshOnWakeUp!");
                    vis.onWakeUp(function () {
                        // TODO this does not work. :(
                        //console.log("wakeup refresh!");
                        $this.attr('src', src + ((src.indexOf('?') != -1) ? '&' : '?') + '_vis_refts=' + ((new Date()).getTime()));
                        //console.log($this.attr('src'));
                    });
                }
            }
        },
        showSvg: function (myClass, view, wid, oid, opacity, svg_false, svg_true, style) {
            var obj = {myClass: myClass, view: view, wid: wid, oid: oid, opacity: opacity, svg_false: svg_false, svg_true: svg_true};
            if (document.getElementById (wid)) {
                $('#' + wid).remove ();
            }
            var str = vis.states.attr(oid + '.val');
            var val = parseFloat(str);
            var sText = '<svg class="vis-widget ' + (myClass || "") + '" version="1.1" style="width:100px;height:100px" xmlns="http://www.w3.org/2000/svg" id="' + wid + '" data-oid="' + oid + '">';
            if (vis.editMode) {
                if (opacity === undefined || opacity === null || opacity === '') opacity = 1;

                if (parseFloat(opacity) < 0.2) opacity = 0.2;
            }
            if (val === 0 || str === "false" || str === false || str === null) {
                // try to analyse
                sText += svg_false;
            }
            else {
                sText += svg_true;
            }
            sText += '</svg>';
            $('#visview_'+view).append (sText);

            $('#' + wid).children().attr('data-wid', wid);
            $('#' + wid).children().attr('data-oid', oid);
            $('#' + wid).children().attr('opacity', opacity);
            if ($('#' + wid).children()[0]) {
                $('#' + wid).children()[0]._obj = obj;
            }

            if (style) {
                $('#' + wid).css(style);
            }

            if (!vis.editMode) {
                $('#'+wid).children().click(function () {
                    var $this = $(this);
                    var id = $this.attr('data-oid');
                    var val = vis.states[id + '.val'];
                    if (val === null || val === '' || val === undefined || val === false || val === "false") {
                        vis.setValue(id, true);
                    } else if (val === true || val === "true") {
                        vis.setValue(id, false);
                    } else {
                        val = parseFloat(val);
                        if (val >= 0.5) {
                            val = 1;
                        } else {
                            val = 0;
                        }
                        vis.setValue(id, 1 - val);
                    }
                    var el = $('#'+obj.wid);
                    this._obj.style = {
                        "position":'absolute',
                        top:    el.position().top,
                        width:  el.width(),
                        left:   el.position().left,
                        height: el.height()
                    };
                    _setTimeout(function (obj) {
                        vis.binds.basic.showSvg(obj.myClass, obj.view, obj.wid, obj.oid, obj.opacity, obj.svg_false, obj.svg_true, obj.style);
                    }, 200, this._obj);
                });
            }
        },
        editNote: function (wid, max_width, min_width, min_height, oid) {
            if (vis.editMode) return;

            max_width  = max_width  ? parseInt(max_width,  10) : 400;
            min_width  = min_width  ? parseInt(min_width,  10) : 40;
            min_height = min_height ? parseInt(min_height, 10) : 15;

            var $this = $('#div_' + wid);
            $('body').append('<div id="dlg_' + wid + '" title="' + _('Edit note') + '">' +
            '<textarea style="resize: none; width:95%; height:92%" id="text_' + wid + '">' + $this.text().trim() + '</textarea></div>');

            var buttons = {};
            buttons[_('Clear')] = function () {
                $('#text_' + $(this).attr('data-wid')).val("");
            };

            buttons[_('Ok')] = function () {
                var dlg  = $(this);
                var oid  = dlg.attr('data-oid');
                var wid  = dlg.attr('data-wid');
                var text = $('#text_' + wid).val();
                text = text.replace('\n', '<br>\n');

                if (!oid) $('#div_' + wid).html(text);
                /*if (!text) {
                 $('#' + wid).css({width: min_width, height: min_height});
                 }
                 else {
                 $('#' + wid).css({width: max_width, height: 'auto'});
                 }*/

                if (oid) vis.setValue(oid, text);

                dlg.dialog('close');
                dlg.remove();
            };

            buttons[_('Cancel')] = function () {
                $(this).dialog('close');
                $(this).remove();
            };

            $('#dlg_' + wid).attr('data-oid', oid).attr('data-wid', wid).dialog({
                width:   500,
                height:  300,
                modal:   true,
                buttons: buttons
            });
        },
        formatFloat: function (data) {
            var val;
            if (vis.editMode && data.attr('test_html') !== undefined && data.attr('test_html') !== '') {
                val = parseFloat(data.attr('test_html'));
            } else {
                val = parseFloat(vis.states.attr(data.oid + '.val'));
            }
            if (data.factor !== undefined && data.factor != '') val = val * parseFloat(data.factor);
            if (data.digits !== undefined && data.digits != '') val = val.toFixed(parseFloat(data.digits, 10));

            if (data.attr('is_comma')) {
                val = '' + val;
                val = val.replace('.', ',');
            }

            return val;
        },
        extractWidth: function (css, multiplier) {
            // extract from "2px solid #aabbcc" => 2px
            var m = css.match(/([0-9])+(px|em)?/);
            if (m) {
                if (m[1] && m[2]) {
                    return parseInt(m[1], 10) * (multiplier || 1) + m[2];
                } else {
                    return parseInt(m[1], 10) * (multiplier || 1);
                }
            }
        },
        getCalc: function (data) {
            //<%=
            return (data.border) ? ("calc(" + (parseFloat(vis.states.attr(data.oid + '.val')) * data.factor) + "% - " + vis.binds.basic.extractWidth(data.border, 2) + ")") : ((parseFloat(vis.states.attr(data.oid + '.val')) * data.factor) + "%");
            //        %>
        },
        formatDate: function (dateObj, isSeconds, format) {
            if (typeof isSeconds != 'boolean') {
                format = isSeconds;
                isSeconds = false;
            }

            if (format == 'auto') format = (vis.dateFormat || 'DD.MM.YYYY') + ' hh:mm:ss';

            var format = format || vis.dateFormat || 'DD.MM.YYYY';

            if (!dateObj) return '';
            var text = typeof dateObj;
            if (text == 'string') {
                var pos = dateObj.indexOf('.');
                if (pos != -1) dateObj = dateObj.substring(0, pos);
                return dateObj;
            }
            if (text != 'object') dateObj = isSeconds ? new Date(dateObj * 1000) : new Date(dateObj);

            var v;

            // Year
            if (format.indexOf('YYYY') != -1 || format.indexOf('JJJJ') != -1 || format.indexOf('ГГГГ') != -1) {
                v = dateObj.getFullYear();
                format = format.replace('YYYY', v);
                format = format.replace('JJJJ', v);
                format = format.replace('ГГГГ', v);
            } else if (format.indexOf('YY') != -1 || format.indexOf('JJ') != -1 || format.indexOf('ГГ') != -1) {
                v = dateObj.getFullYear() % 100;
                format = format.replace('YY', v);
                format = format.replace('JJ', v);
                format = format.replace('ГГ', v);
            }
            // Month
            if (format.indexOf('MM') != -1 || format.indexOf('ММ') != -1) {
                v =  dateObj.getMonth() + 1;
                if (v < 10) v = '0' + v;
                format = format.replace('MM', v);
                format = format.replace('ММ', v);
            } else if (format.indexOf('M') != -1 || format.indexOf('М') != -1) {
                v =  dateObj.getMonth() + 1;
                format = format.replace('M', v);
                format = format.replace('М', v);
            }

            // Day
            if (format.indexOf('DD') != -1 || format.indexOf('TT') != -1 || format.indexOf('ДД') != -1) {
                v =  dateObj.getDate();
                if (v < 10) v = '0' + v;
                format = format.replace('DD', v);
                format = format.replace('TT', v);
                format = format.replace('ДД', v);
            } else if (format.indexOf('D') != -1 || format.indexOf('TT') != -1 || format.indexOf('Д') != -1) {
                v =  dateObj.getDate();
                format = format.replace('D', v);
                format = format.replace('T', v);
                format = format.replace('Д', v);
            }

            // hours
            if (format.indexOf('hh') != -1 || format.indexOf('SS') != -1 || format.indexOf('чч') != -1) {
                v =  dateObj.getHours();
                if (v < 10) v = '0' + v;
                format = format.replace('hh', v);
                format = format.replace('SS', v);
                format = format.replace('чч', v);
            } else if (format.indexOf('h') != -1 || format.indexOf('S') != -1 || format.indexOf('ч') != -1) {
                v =  dateObj.getHours();
                format = format.replace('h', v);
                format = format.replace('S', v);
                format = format.replace('ч', v);
            }

            // minutes
            if (format.indexOf('mm') != -1 || format.indexOf('мм') != -1) {
                v =  dateObj.getMinutes();
                if (v < 10) v = '0' + v;
                format = format.replace('mm', v);
                format = format.replace('мм', v);
            } else if (format.indexOf('m') != -1 ||  format.indexOf('м') != -1) {
                v =  dateObj.getMinutes();
                format = format.replace('m', v);
                format = format.replace('v', v);
            }

            // seconds
            if (format.indexOf('ss') != -1 || format.indexOf('сс') != -1) {
                v =  dateObj.getSeconds();
                if (v < 10) v = '0' + v;
                format = format.replace('ss', v);
                format = format.replace('cc', v);
            } else if (format.indexOf('s') != -1 || format.indexOf('с') != -1) {
                v =  dateObj.getHours();
                format = format.replace('s', v);
                format = format.replace('с', v);
            }
            return format;
        },
        detectScreen: function (el) {
            if (vis.navChangeCallbacks.indexOf(vis.binds.basic.detectScreen) == -1) {
                vis.navChangeCallbacks.push(vis.binds.basic.detectScreen);
            }

            setTimeout(function () {
                $(window).bind('resize', function () {
                    if (vis.editMode) {
                        $('.vis-resolution-width').html(vis.views[vis.activeView].settings.sizex  || $(window).width());
                        $('.vis-resolution-height').html(vis.views[vis.activeView].settings.sizey || $(window).height());
                        $('.vis-resolution-default-view').html(vis.findNearestResolution(vis.views[vis.activeView].settings.sizex || $(window).width(), vis.views[vis.activeView].settings.sizey || $(window).height()));
                    } else {
                        $('.vis-resolution-width').html($(window).width());
                        $('.vis-resolution-height').html($(window).height());
                        $('.vis-resolution-default-view').html(vis.findNearestResolution());
                    }
                });
                if (vis.editMode) {
                    $('.vis-resolution-width').html(vis.views[vis.activeView].settings.sizex  || $(window).width());
                    $('.vis-resolution-height').html(vis.views[vis.activeView].settings.sizey || $(window).height());
                    $('.vis-resolution-default-view').html(vis.findNearestResolution(vis.views[vis.activeView].settings.sizex || $(window).width(), vis.views[vis.activeView].settings.sizey || $(window).height()));
                } else {
                    $('.vis-resolution-width').html($(window).width());
                    $('.vis-resolution-height').html($(window).height());
                    $('.vis-resolution-default-view').html(vis.findNearestResolution());
                }
            }, 100);
        }
    };

    $(document).mouseup(function () {
        if (vis.binds.basic.pressed) {
            clearInterval(vis.binds.basic.pressed);
        }
    });

</script>


<!-- Basic Widgets -->


<script id="tplHtml"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="static"
        data-vis-name="HTML"
        data-vis-prev='<img src="widgets/basic/img/Prev_HTML.png"></img>'
        data-vis-attrs="html;refreshInterval[0]/slider,0,180000,100">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" <%= (el) -> vis.binds.basic.htmlRefresh(el, this.data.attr('html'), data.attr("refreshInterval")) %>>
            <%== this.data.attr('html') %>
        </div>
    </div>
</script>

<script id="tplIFrame"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="static"
        data-vis-prev='<img src="widgets/basic/img/Prev_iFrame.png"></img>'
        data-vis-name="iFrame"
        data-vis-attrs="src;refreshInterval[0]/slider,0,180000,100">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 600px; height: 320px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <% if (vis.editMode) { %>
            <div class="editmode-helper" />
            <% } %>
            <iframe src="<%= this.data.attr('src') %>" style="position: absolute; border: 0; padding: 0; margin: 0; width: 100%; height:100%;"></iframe>
            <div <%= (el) -> vis.binds.basic.iframeRefresh(el, data.attr("src"), data.attr("refreshInterval")) %>></div>
        </div>
    </div>
</script>

<script id="tplImage"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="static"
        data-vis-prev='<img src="widgets/basic/img/Prev_Image.png"></img>'
        data-vis-name="Image"
        data-vis-attrs="src/image;stretch/checkbox;refreshInterval[0]/slider,0,180000,100;refreshOnWakeUp[false]/checkbox;refreshOnViewChange[false]/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <% if (vis.editMode) { %>
                <div class="editmode-helper" />
            <% } %>
            <img style="position:absolute; width:100%;<%= this.data.attr('stretch') ? 'height:100%' : '' %>" <%= this.data.attr('src') ? 'src="' + this.data.attr('src') + '"' : '' %> />
            <div <%= (el) -> vis.binds.basic.imgRefresh(el, data.attr("src"), data.attr('refreshInterval'), data.attr('refreshOnWakeUp'), data.attr('refreshOnViewChange')) %> />
        </div>
    </div>
</script>

<script id="tplLink"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplLink" style=" position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-selectee vis-widget-lock" style="height: 22px" > <div class="vis-widget-prev-body"> <a style="text-decoration:none;width:100%;height:100%"><div style="width:100%;height:100%;text-algin:center">www.ioBroker.com</div></a> </div> </div>'
        data-vis-set="basic"
        data-vis-type="static"
        data-vis-name="link"
        data-vis-attrs="html;href;target/auto,,_blank,_self,_parent,_top;alt">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px; " id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <a href="<%== this.data.attr('href') %>" target="<%== this.data.attr("target") %>" alt="<%== this.data.attr("alt") %>" style="text-decoration:none;width:100%;height:100%"><div style="width:100%;height:100%"><%== this.data.attr("html") %></div></a>
        </div>
    </div>
</script>

<script id="tplFrame"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplFrame" style=" position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev vis-widget-lock" style="overflow: visible; width: 90px; height: 90px; border: 3px solid rgb(0, 0, 255); left: 90px; top: 222px;" > 	 <div style="width: 100%; height: 0px; background-color: black;">		</div> <div style="position: absolute; top: 1px; left: 29px; color: rgb(0, 0, 255);">Border</div> 		 </div>'
        data-vis-set="basic"
        data-vis-type="static"
        data-vis-name="Border"
        data-vis-attrs="title['Title'];title_font;title_color[black]/color;title_back/color;title_top[-10]/slider,-20,20,1;title_left[15]/slider,-20,30,1;header_height[0]/slider,0,100,1;header_color[black]/color">
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow:visible;width:50px;height:50px;border:1px solid #888" id="<%= this.data.attr('wid') %>" >
        <% if (this.data.attr('header_height')) { %>
	    <div style="width:100%;height:<%= this.data.attr('header_height') %>px;background-color:<%= this.data.attr('header_color') %>">
		<% } %>
        <div style="position:absolute;top:<%= this.data.attr('title_top') %>px;left:<%= this.data.attr('title_left') %>px;color:<%== this.data.attr('title_color') %>;background:<%== this.data.attr('title_back') %>;font:<%== this.data.attr('title_font') %>"><%== this.data.attr('title') %></div>
        <% if (this.data.attr('header_height')) { %>
        </div>
		<% } %>
    </div>
</script>

<!-- basic Container -->
<script id="tplContainerView"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="container"
        data-vis-name="view in widget"
        data-vis-attrs="contains_view/views">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:400px; height: 270px;" id="<%= this.data.attr('wid') %>">
            <% if (vis.editMode) { %>
                <div class="editmode-helper" />
            <% } %>
            <div data-vis-contains="<%= this.data.attr('contains_view') %>" class="vis-widget-body vis-view-container">
        </div>
    </div>
</script>

<!-- Stateful Widgets -->
<script id="tplStatefulContainerView8"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="stateful,container"
        data-vis-name="view in widget 8"
        data-vis-attrs="oid;persistent/checkbox;contains_view_(0-7)/views">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:400px; height: 270px;" id="<%= this.data.attr('wid') %>">
        <% if (vis.editMode) { %>
            <div class="editmode-helper" />
        <% } %>
        <%
            var viewArr = [];
            var i = 0;
            while(data.attr("contains_view_" + i) !== undefined) {
                viewArr.push(data.attr("contains_view_" + i));
                i++;
            }
        %>
        <div class="vis-widget-body">
            <div class="vis-view-container" data-oid="<%= data.attr('oid') %>" data-vis-contains="<%= vis.binds.stateful.value(viewArr, data.attr('oid')) %>" <%= (el) -> vis.binds.stateful.view(el, viewArr, data.attr("persistent")) %> />
        </div>
        <!--div data-vis-contains="<%= vis.binds.stateful.value(viewArr, data.attr('oid')) %>" class="vis-widget-body">
            <div class="vis-view-container" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> dui.binds.stateful.view(el, viewArr, data.attr("persistent")) %> />
        </div-->
    </div>
</script>

<script id="tplStatefulIFrame8"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="stateful"
        data-vis-name="iFrame 8"
        data-vis-attrs="oid;refreshInterval[0]/slider,0,180000,100;src_(0-7)">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 600px; height: 320px;" id="<%= this.data.attr('wid') %>">
        <% if (vis.editMode) { %>
            <div class="editmode-helper"/>
        <% } %>
        <div class="vis-widget-body">
            <% if (vis.editMode) { %>
                <div class="editmode-helper"/>
            <% } %>
            <%
                var srcArr = [];
                var i = 0;
                while(data.attr("src_" + i) !== undefined) {
                    srcArr.push(data.attr("src_" + i));
                    i++;
                }
            %>
            <iframe class="vis-widget-element" data-oid="<%= this.data.attr('oid') %>" src="<%== vis.binds.stateful.value(srcArr, data.attr('oid')) %>" style="position: absolute; border: 0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <div <%= (el) -> vis.binds.stateful.iframe(el, srcArr, data.attr("refreshInterval")) %> />
        </div>
    </div>
</script>

<!-- TODO
<script type="text/ejs" id="tplStatefulIFrame8Persistent" class="vis-tpl" data-vis-set="basic" data-vis-name="stateful - iFrame 8 (persistent)" data-vis-attrs="oid;refreshInterval;src_(0-1)">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 600px; height: 320px;" id="<%= this.data.attr('wid') %>">
            <% if (vis.editMode) { %>
                <div class="editmode-helper" />
            <% } %>
          <div class="vis-widget-body">
            <% if (vis.editMode) { %>
                <div class="editmode-helper" />
            <% } %>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_0') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_1') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_2') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_3') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_4') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_5') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_6') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_7') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <div <%= (el) -> vis.binds.stateful.iframe(el, [data.attr("src_0"), data.attr("src_1"), data.attr("src_2"), data.attr("src_3"), data.attr("src_4"), data.attr("src_5"), data.attr("src_6"), data.attr("src_7"]), data.attr("refreshInterval")) %> />
        </div>
    </div>
</script>
-->

<script id="tplStatefulImage8"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="stateful"
        data-vis-name="Image 8"
        data-vis-attrs="oid;refreshInterval[0]/slider,0,180000,100;src_(0-7)/image">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px;" id="<%= this.data.attr('wid') %>">
        <% if (vis.editMode) { %>
            <div class="editmode-helper" />
        <% } %>
        <div class="vis-widget-body">
            <% if (vis.editMode) { %>
                <div class="editmode-helper" />
            <% } %>
            <%
                var srcArr = [];
                var i = 0;
                while(data.attr("src_" + i) !== undefined) {
                    srcArr.push(this.data.attr("src_" + i));
                    i++;
                }
            %>
            <img class="vis-widget-element" data-oid="<%= this.data.attr('oid') %>" style="position:absolute; width:100%;" src="<%== vis.binds.stateful.value(srcArr, this.data.attr('oid')) %>" />
            <div <%= (el) -> vis.binds.stateful.image(el, srcArr, data.attr('refreshInterval')) %> />
        </div>
    </div>
</script>

<script id="tplHtmlNav"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="static,navigation"
        data-vis-name="HTML"
        data-vis-attrs="html;nav_view;sync/checkbox;body-background/color;group.effects;hide_effect/effect;hide_duration/slider,0,10000,100;hide_options/effect-options;show_effect/effect;show_duration/slider,0,10000,100;show_options/effect-options">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px; " id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.basic.navigation(el, {nav_view: data.attr('nav_view'), hideOptions: {effect: data.attr('hide_effect'), options: (data.attr('hide_options') ? data.attr('hide_options') : {}),duration:data.attr('hide_duration')}, showOptions: {effect:data.attr('show_effect'), options: (data.attr('show_options') ? data.attr('show_options') : {}), duration: data.attr('show_duration')}, sync: data.attr('sync'), background: data.attr('body-background')}) %>>
        <div class="vis-widget-body">
            <%== this.data.attr('html') %>
        </div>
    </div>
</script>

<script id="tplFilterDropdown"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplFilterDropdown" style="text-align: initial;padding: 4px"><div class="vis-widget_prev vis-widget-lock" style="width: 60px; height: 23px;" > <div class="vis-widget-prev-body"> <select id="" name=""> <option value="" selected="selected">all</option> <option value="filter">filter</option></select> </div> </div>'
        data-vis-set="basic"
        data-vis-type="filter"
        data-vis-name="filter - dropdown"
        data-vis-attrs="filters;group.effects;hide_effect/effect;hide_duration/slider,0,10000,100;show_effect/effect;show_duration/slider,0,10000,100">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left:0px; width: 200px; height: 40px;" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.basic.filterDropdown(el, data.attr('filters'), data.attr('hide_effect'), data.attr('hide_duration'), data.attr('show_effect'),data.attr('show_duration')) %>>
        <div class="vis-widget-body">
            <select id="" name="">
                <option value="">all</option>
            </select>
        </div>
    </div>
</script>

<script id="tplValueFloat"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-prev='<div id="prev_tplValueFloat" style="text-align: initial;padding: 4px "><div class="vis-widget_prev" style="width: 74px; height: 18px; text-align: center;color:red; font-weight:bold" > <div class="vis-widget-prev-body"> <div>52,57 MB</div> </div> </div></div>'
        data-vis-name="Number"
        data-vis-attrs="oid;html_prepend;html_append_singular;html_append_plural;group.extended;digits;is_comma[true]/checkbox;factor[1];oid-quality;class_true;class_false;test_html">
    <div class="vis-widget <%== (vis.states.attr(this.data['oid-quality'] + ".val") == "true" ||  vis.states.attr(this.data['oid-quality'] + ".val") === true) ? this.data.attr('class_true') : this.data.attr('class_false') %> <%== this.data.attr('class') %>" style="top:0px; left:0px; width:60px; height:18px" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr("html_prepend") %><%= vis.binds.basic.formatFloat(this.data) %><%== (parseFloat(vis.binds.basic.formatFloat(this.data)) == 1 ? this.data.attr("html_append_singular") : this.data.attr("html_append_plural")) %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueString"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="String"
        data-vis-prev='<div id="tplValueString" style="text-align: initial;padding: 4px "><div class="vis-widget_prev" style="width: 74px; height: 18px; text-align: center;color:blue; font-weight:bold" > <div class="vis-widget-prev-body"> <div>Text</div> </div> </div></div>'
        data-vis-attrs="oid;html_prepend;html_append;test_html">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 50px; height: 20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr("html_prepend") %><%= (vis.editMode && this.data.attr('test_html')) ? this.data.attr('test_html') : vis.states.attr(this.data.oid + ".val") %><%== this.data.attr("html_append") %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueStringRaw"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-prev='<div id="tplValueStringRaw" style="text-align: initial;padding: 4px "><div class="vis-widget_prev" style="width: 90px; height: 18px; text-align: center;color:#8B008B; font-weight:bold" > <div class="vis-widget-prev-body"> <div><xmp><div>Text</div></xmp></div> </div> </div></div>'
        data-vis-name="String (unescaped)"
        data-vis-attrs="oid;html_prepend;html_append;test_html">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 50px; height: 20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr("html_prepend") %><%== (vis.editMode && this.data.attr('test_html')) ? this.data.attr('test_html') : vis.states.attr(this.data.oid + ".val") %><%== this.data.attr("html_append") %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueTimestamp"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val,timestamp"
        data-vis-name="Timestamp"
        data-vis-prev='<div id="prev_tplValueTimestamp" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev" style="width: 90px; height: 25px;text-align:center;color:#00008B" > <div class="vis-widget-prev-body"> <div> 2015-02-22 19:30:46 </div> </div> </div></div>'
        data-vis-attrs="oid;is_milliseconds/checkbox;format_date/auto,YYYY.MM.DD hh:mm:ss,DD.MM.YYYY hh:mm:ss,YYYY.MM.DD,DD.MM.YYYY,YYYY/MM/DD hh:mm:ss,YYYY/MM/DD,hh:mm:ss;html_prepend;html_append;test_html">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 50px; height: 20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr("html_prepend") %><%== (vis.editMode && this.data.attr('test_html')) ? this.data.attr('test_html') : vis.binds.basic.formatDate(vis.states.attr(this.data.oid + ".ts"), !this.data.attr("is_milliseconds"), this.data.attr("format_date")) %><%== this.data.attr("html_append") %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueLastchange"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val,timestamp"
        data-vis-prev='<div id="prev_tplValueLastchange" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev" style="width: 90px; height: 25px;text-align:center;color:#006400" > <div class="vis-widget-prev-body"> <div> 2015-02-22 19:30:46 </div> </div> </div></div>'
        data-vis-name="Last change Timestamp"
        data-vis-attrs="oid;is_milliseconds/checkbox;format_date/auto,YYYY.MM.DD hh:mm:ss,DD.MM.YYYY hh:mm:ss,YYYY.MM.DD,DD.MM.YYYY,YYYY/MM/DD hh:mm:ss,YYYY/MM/DD,hh:mm:ss;html_prepend;html_append;test_html">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 50px; height: 20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr("html_prepend") %><%== (vis.editMode && this.data.attr('test_html')) ? this.data.attr('test_html') : vis.binds.basic.formatDate(vis.states.attr(this.data.oid + ".lc"), !this.data.attr("is_milliseconds"), this.data.attr("format_date")) %><%== this.data.attr("html_append") %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueStringImg"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="String img src"
        data-vis-attrs="oid;html_prepend;html_append;refreshInterval[0]/slider,0,180000,100">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left:0px; width:60px; height: 40px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr("html_prepend") %>
                <img <%= vis.states.attr(this.data.oid + ".val" ) ? "src='" +  vis.states.attr(this.data.oid + ".val" ) + "'" : "" %> width="100%"/>
                 <div <%= (el) -> vis.binds.basic.imgRefresh(el, vis.states.attr(data.oid + ".val" ), data.attr("refreshInterval")) %> />
                <%== this.data.attr("html_append") %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueList"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="ValueList Text"
        data-vis-attrs="oid;html_prepend;html_append;valuelist;test_list/nselect,,0,1,2,3,4,5,6,7,8,9,10,11,12">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px;left:0px;width:60px;height:20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr("html_prepend") %><% var list = (data.valuelist ? data.valuelist.split(';') : []); %><%= list[(vis.editMode && this.data.attr('test_list') !== '') ? parseInt(this.data.attr('test_list')) : parseInt(vis.states.attr(this.data.oid + ".val"), 10)] %><%== this.data.attr("html_append") %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueListHtml"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="ValueList HTML"
        data-vis-attrs="oid;html_prepend;html_append;valuelist;test_list/nselect,,0,1,2,3,4,5,6,7,8,9,10,11,12">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px;left:0px;width:60px;height:20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr("html_prepend") %><% var list = (data.valuelist ? data.valuelist.split(';') : []); %><%== list[(vis.editMode && this.data.attr('test_list') !== '') ? parseInt(this.data.attr('test_list')) : parseInt(vis.states.attr(this.data.oid + ".val"), 10)] %><%== this.data.attr("html_append") %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueListHtml8"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="ValueList HTML Style"
        data-vis-attrs="oid;html_prepend;html_append;count[2]/number,0,10,1;value(0-count);style(0-count);test_list/nselect,,0,1,2,3,4,5,6,7,8,9,10,11,12">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 100px; height: 30px; background-color:gray" id="<%= this.data.attr('wid') %>">
        <%
            var slist = [];
            var i = 0;
            while (data['style' + i] !== undefined) {
                slist[i] = data['style' + i]; i++;
            }
            console.log(slist[(vis.editMode && this.data.attr('test_list') !== '') ? parseInt(this.data.attr('test_list')) : (parseInt((vis.states.attr(this.data.oid + ".val") == true ? 1 : (vis.states.attr(this.data.oid + ".val") == false ? 0 : vis.states.attr(this.data.oid + ".val"))), 10))]);
        %>
        <div class="vis-widget-body" style="<%== slist[(vis.editMode && this.data.attr('test_list') !== '') ? parseInt(this.data.attr('test_list')) : (parseInt((vis.states.attr(this.data.oid + ".val") == true ? 1 : (vis.states.attr(this.data.oid + ".val") == false ? 0 : vis.states.attr(this.data.oid + ".val"))), 10))] %>">
            <div data-oid="<%= this.data.attr('oid') %>">
               <%== this.data.attr("html_prepend") %><%
                   var list = [];
                   var j = 0;
                   while (data['value' + j] !== undefined) {
                        list[j] = data['value' + j]; j++;
                   }
                   %><%== list[(vis.editMode && this.data.attr('test_list') !== '') ? parseInt(this.data.attr('test_list')) : (parseInt((vis.states.attr(this.data.oid + ".val") == true ? 1 : (vis.states.attr(this.data.oid + ".val") == false ? 0 : vis.states.attr(this.data.oid + ".val"))), 10))] %><%== this.data.attr("html_append") %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueBool"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="Bool HTML"
        data-vis-attrs="oid;html_prepend;html_append;html_false;html_true">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:76px; height:76px;" id="<%= this.data.attr('wid') %>"  data-oid="<%= this.data.attr('oid') %>" >
        <div class="vis-widget-body">
            <%== this.data.attr("html_prepend") %>
            <%
            var str = vis.states.attr(this.data.oid + ".val");
            var val = parseFloat(str);
            var state;
            if (str === false || str === "false" || val == 0) {
            %>
            <%== this.data.attr("html_false") %>
            <% } else { %>
            <%== this.data.attr("html_true") %>
            <% } %>
            <%== this.data.attr("html_append") %>
        </div>
    </div>
</script>

<script id="tplAckBool"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="AckFlag HTML"
        data-vis-attrs="oid;html_prepend;html_append;html_false;html_true">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:76px; height:76px;" id="<%= this.data.attr('wid') %>"  data-oid="<%= this.data.attr('oid') %>" >
        <div class="vis-widget-body">
            <%== this.data.attr("html_prepend") %>
            <%
            var str = vis.states.attr(this.data.oid + ".ack");
            var val = parseFloat(str);
            var state;
            if (str === false || str === "false" || val == 0) {
            %>
            <%== this.data.attr("html_false") %>
            <% } else { %>
            <%== this.data.attr("html_true") %>
            <% } %>
            <%== this.data.attr("html_append") %>
        </div>
    </div>
</script>

<script id="tplValueBoolCheckbox"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplValueBoolCheckbox" style=" position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev vis-widget-lock ui-selectee ui-selected" style="left: 232px; top: 312px;" > <div class="vis-widget-prev-body"><input type="checkbox" name="w00004_checkbox"></div> </div>'
        data-vis-set="basic"
        data-vis-type="ctrl"
        data-vis-name="Bool Checkbox"
        data-vis-attrs="oid;html_prepend;html_append">
    <div class="vis-widget <%== this.data.attr('class') %>" style="" id="<%= this.data.attr('wid') %>" >
        <div class="vis-widget-body">
			<%== this.data.attr("html_prepend") %>
			<input type="checkbox" name="<%= this.data.attr('wid') %>_checkbox" id="<%= this.data.attr('wid') %>_checkbox" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.checkbox(el) %>/>
			<%== this.data.attr("html_append") %>
        </div>
    </div>
</script>

<script id="tplValueBoolSelect"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="ctrl"
        data-vis-name="Bool Select"
        data-vis-attrs="oid;html_prepend;html_append;text_true;text_false">
    <div class="vis-widget <%== this.data.attr('class') %>" style="" id="<%= this.data.attr('wid') %>" >
        <div class="vis-widget-body">
			<%== this.data.attr("html_prepend") %>
			<select id="<%= this.data.attr('wid') %>_select" data-oid="<%= this.data.attr('oid') %>">
				<option value="0" selected='selected'><%= this.data.attr('text_false') %></option>
				<option value="1"><%= this.data.attr('text_true') %></option>
			</select>
			<div <%= (el) -> vis.binds.basic.select(el) %>></div>
			<%== this.data.attr("html_append") %>
        </div>
    </div>
</script>

<script id="tplValueBoolCtrl"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="ctrl"
        data-vis-name="Bool HTML"
        data-vis-attrs="oid;html_prepend;html_append;html_false;html_true">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:76px; height:76px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.toggle(el) %>>
        <div class="vis-widget-body">
			<%== this.data.attr("html_prepend") %>
			<%
			var str = vis.states.attr(this.data.oid + ".val");
			var val = parseFloat(str);
			var state;
			if (val === 0 || str === "false" || str === false) {
			%>
			    <%== this.data.attr("html_false") %>
			<% } else { %>
			    <%== this.data.attr("html_true") %>
			<% } %>
			<%== this.data.attr("html_append") %>
        </div>
    </div>
</script>

<script id="tplValueBoolCtrlSvg"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="ctrl,bool"
        data-vis-name="Bool SVG"
        data-vis-attrs="oid;svg_false;svg_true;opacity/slider,0,1,0.05">
    <% vis.binds.basic.showSvg(this.data.attr('class'), this.view, this.data.attr('wid'), this.data.attr('oid'),this.data.attr("opacity"),this.data.attr("svg_false"),this.data.attr("svg_true")) %>
</script>

<script id="tplBasicState"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="ctrl"
        data-vis-name="HTML State"
        data-vis-attrs="html;oid;value">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:76px; height:76px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" data-val="<%= this.data.attr('value') %>" <%= (el) -> vis.binds.basic.state(el) %>>
        <div class="vis-widget-body">
			<%== this.data.attr("html") %>
        </div>
    </div>
</script>

<script id="tplHide"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="Hide on 0/False"
        data-vis-attrs="oid;html;html_prepend;html_append">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 50px; height: 50px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.hideOnFalse(el) %>>
        <div class="vis-widget-body">
            <%== this.data.attr("html_prepend") %><%== this.data.attr('html') %><%== this.data.attr("html_append") %>
        </div>
    </div>
</script>

<script id="tplHideTrue"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="Hide on >0/True"
        data-vis-attrs="oid;html;html_prepend;html_append">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 50px; height: 50px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.hideOnTrue(el) %>>
        <div class="vis-widget-body">
            <%== this.data.attr("html_prepend") %><%== this.data.attr('html') %><%== this.data.attr("html_append") %>
        </div>
    </div>
</script>

<script id="tplShowValue"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="Show on Value"
        data-vis-attrs="oid;value;html;html_prepend;html_append">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 50px; height: 50px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.showOnValue(el, data.attr('value')) %>>
        <div class="vis-widget-body">
            <%== this.data.attr("html_prepend") %><%== this.data.attr('html') %><%== this.data.attr("html_append") %>
        </div>
    </div>
</script>

<script id="tplRedNumber"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="Red Number"
        data-vis-prev='<div id="prev_tplRedNumber" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-selectee ui-draggable-handle " style="padding: 3px; width: auto; min-width: 21px; height: 21px; border-radius: 16px; border: 3px solid white; color: white; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 20px; line-height: normal; font-family: Helvetica; text-align: center; position: absolute; background-color: red;" data-o> <div class="vis-widget-prev-body"> 5 </div> </div></div>'
        data-vis-attrs="oid;html_prepend;html_append_singular;html_append_plural">
    <div class="vis-widget <%== this.data.attr('class') %>" style="padding:3px;width:auto;min-width: 21px; height: 21px; border-radius:16px; border: 3px solid white; background-color:red; color:white; font:normal normal normal 20px/normal Helvetica; text-align: center;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.hideOnFalse(el) %>>
        <div class="vis-widget-body" >
            <%== this.data.attr("html_prepend") %><%= parseInt(vis.states.attr(this.data.oid + '.val'), 10) %><%== (parseInt(vis.states.attr(this.data.oid+".val"), 10) == 1 ? this.data.attr("html_append_singular") : this.data.attr("html_append_plural")) %>
        </div>
    </div>
</script>

<script id="tplBulbOnOff"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplBulbOnOff" style="position: relative; text-align: initial;padding: 4px "><div data-o class="vis-widget_prev ui-selectee" style="left: 82px; top: 31px;"> <div class="vis-widget-prev-body"> <img src="img/bulb_on.png" width="100%"> </div> </div>'
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="Bulb on/off"
        data-vis-attrs="oid">
    <div data-oid="<%= this.data.attr('oid') %>" class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" style="width: 44px; height: 59px">
        <div class="vis-widget-body">
            <% switch (vis.states.attr(this.data.oid + '.val')) { case null: case '': case undefined: case 0: case "0": case "0.000000": case false: case "false": %>
                <img src="img/bulb_off.png" width="100%"/>
            <% break; default: %>
                <img src="img/bulb_on.png" width="100%"/>
            <% } %>
        </div>
    </div>
</script>

<script id="tplBulbOnOffCtrl"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplBulbOnOffCtrl" style="position: relative; text-align: initial;padding: 4px "><div data-o class="vis-widget_prev" style="left: 393.0909091234207px; top: 246.9147720336914px;"> <div class="vis-widget-prev-body"> <img src="img/bulb_on.png" width="100%"> </div> </div>'
        data-vis-set="basic"
        data-vis-type="ctrl"
        data-vis-name="Bulb on/off"
        data-vis-attrs="oid">
    <div data-oid="<%= this.data.attr('oid') %>" class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.basic.toggle(el) %>  style="width: 44px; height: 59px">
    <div class="vis-widget-body">
        <% switch (vis.states.attr(this.data.oid + ".val")) { case null: case '': case undefined: case 0: case "0": case "0.000000": case "false": case false: %>
        <img src="img/bulb_off.png" width="100%"/>
        <% break; default: %>
        <img src="img/bulb_on.png" width="100%"/>
        <% } %>
    </div>
    </div>
</script>

<script id="tplHmWindowRotary"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="Turning handle"
        data-vis-attrs="oid;html_closed;html_tilt;html_open">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:100px;height:20px" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>">
        <div class="vis-widget-body">
            <% switch (vis.states.attr(this.data.oid + ".val")) { case 0: case "false": case false: %>
            <%== this.data.attr("html_closed") %>
            <% break; case 1: case true: %>
            <%== this.data.attr("html_tilt") %>
            <% break; case 2: %>
            <%== this.data.attr("html_open") %>
            <% break; default: %>
            <%== this.data.attr("html_closed") %>
            <% } %>
        </div>
    </div>
</script>

<script id="tplHmWindow"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="Door/Window sensor"
        data-vis-attrs="oid;html_closed;html_open">
    <div data-oid="<%= this.data.attr('oid') %>" class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" style="height:20px;width:100px">
        <div class="vis-widget-body">
            <% switch (vis.states.attr(this.data.oid + ".val")) { case "true": case true: %>
            <%== this.data.attr("html_open") %>
            <% break; default: %>
            <%== this.data.attr("html_closed") %>
            <% } %>
        </div>
    </div>
</script>

<script id="tplValueFloatBar"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val,bar"
        data-vis-name="Bar Horizontal"
        data-vis-prev='<div id="prev_tplValueFloatBar" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-draggable-handle " style="width: 54px; height: 17px; border: 1px solid rgb(136, 136, 136); left: 458px; top: 292px; position: absolute;" > <div data-o class="vis-widget-prev-body" style="width: 68.6%; background-color: blue;"></div> </div></div>'
        data-vis-attrs="oid;factor[1];color[blue]/color;border;shadow;reverse/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 240px; height: 20px; border: 1px solid #888" id="<%= this.data.attr('wid') %>">
        <div data-oid="<%= this.data.attr('oid') %>"
        class="vis-widget-body"
        style="<%= (this.data.border) ? "height: calc(100% - " + vis.binds.basic.extractWidth(this.data.border, 2) + ");" : "" %><%= (this.data.reverse === "true" || this.data.reverse === true ? "float: right; " : "") %>background-color:<%= this.data.color %>; border: <%= this.data.border %>; box-shadow: <%= this.data.shadow %>;width: <%= vis.binds.basic.getCalc(this.data) %>"></div>
    </div>
</script>

<script id="tplValueFloatBarVertical"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val,bar"
        data-vis-name="Bar Vertical"
        data-vis-prev='<div id="prev_tplValueFloatBarVertical" style="position: relative; text-align: initial;padding: 4px "><div data-o class="vis-widget_prev ui-draggable-handle " style="width: 17px; height: 54px; border: 1px solid rgb(136, 136, 136); left: 435px; top: 105px; position: absolute;" > <div class="vis-widget-prev-body" style="height: 68.58%; position: absolute; bottom: 0%; background-color: blue;"></div> </div></div>'
        data-vis-attrs="oid;factor[1];color[blue]/color;border;shadow;reverse/checkbox">
    <div data-oid="<%= this.data.attr('oid') %>" class="vis-widget <%== this.data.attr('class') %>" style="width:20px; height:240px; border:1px solid #888" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" style="<%= (this.data.border) ? "width: calc(100% - " + vis.binds.basic.extractWidth(this.data.border, 2) + ");" : ""  %>height:<%= vis.binds.basic.getCalc(this.data) + ";" %> %><%= (this.data.reverse === "true" || this.data.reverse === true ? "left:0px; position:absolute; bottom:0%;" : "") %>;border: <%= this.data.border %>; box-shadow:<%= this.data.shadow %>; background-color:<%= this.data.color %>"></div>
    </div>
</script>

<script id="tplNote"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="Note"
        data-vis-prev='<div id="prev_tplNote" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-selectee ui-draggable-handle " style="width: 70px; height: 50px; border: 1px solid rgb(136, 136, 136); left: 965px; top: 16px; position: absolute; background: rgba(255, 255, 105, 0.8);"><div style="padding: 10px">Message</div></div></div>'
        data-vis-attrs="oid;max_width[300];html_prepend;html_append;test_text">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:50px; height:50px; border:1px solid #888; background: rgba(255,255,105,0.8)" id="<%= this.data.attr('wid') %>" onclick="vis.binds.basic.editNote('<%= this.data.attr('wid') %>', '<%= this.data.attr('max_width') %>', '<%= this.data.attr('min_width') %>', '<%= this.data.attr('min_height') %>', '<%= this.data.attr('oid') %>')">
		<div data-oid="<%= this.data.attr('oid') %>" id="div_<%= this.data.attr('wid') %>" style="padding: 10px">
			<%== this.data.attr("html_prepend") %><%= (this.data.test_text && vis.editMode) ? this.data.test_text : (vis.states.attr(this.data.oid + ".val") == null ? "" : vis.states.attr(this.data.oid + ".val")) %><%== this.data.attr("html_append") %>
		</div>
    </div>
</script>

<script id="tplScreenResolution"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplScreenResolution" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev vis-widget-lock ui-selectee ui-draggable-handle " style="width: 120px; height: 54px; border: 1px solid rgb(136, 136, 136); font-size: 12px; opacity: 0.8;" > <div style="padding: 10px"> Width: <span>640</span><br>Height: <span>360</span><br>Default view:<span></span> </div> </div></div>'
        data-vis-set="basic"
        data-vis-type="tools"
        data-vis-name="Screen Resolution"
        data-vis-attrs="">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:150px; height:60px; border: 1px solid #888; font-size: 12px; opacity: 0.8" id="<%= this.data.attr('wid') %>">
		<div id="div_<%= this.data.attr('wid') %>" style="padding: 10px">
			Default view: <span class='vis-resolution-default-view'></span><br>Width: <span class='vis-resolution-width'></span><br>Height: <span class='vis-resolution-height'></span>
		</div>
		<%= vis.binds.basic.detectScreen() %>
    </div>
</script>

